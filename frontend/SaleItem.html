<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Sale Management</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .table-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2 class="text-center mb-4">Vehicle Sale Items</h2>

    <!-- Add/Edit Sale Item Form -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">Add/Edit Sale Item</div>
        <div class="card-body">
            <form id="saleItemForm">
                <input type="hidden" id="id"> <!-- Hidden field for editing -->

                <div class="row">
                    <div class="col-md-4">
                        <label>Bidding Price ($)</label>
                        <input type="number" id="biddingPrice" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label>Date</label>
                        <input type="date" id="time" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label>Item ID</label>
                        <input type="number" id="item_id" class="form-control" required>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label>Sale ID</label>
                        <input type="number" id="sale_id" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label>User ID</label>
                        <input type="number" id="user_id" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label>Sale Status</label>
                        <select id="saleStatus" class="form-select">
                            <option value="forSale">For Sale</option>
                            <option value="sold">Sold</option>
                        </select>
                    </div>
                </div>

                <div class="mt-3 text-end">
                    <button type="reset" class="btn btn-secondary">Clear</button>
                    <button type="submit" class="btn btn-primary">Save Sale Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sale Items Table -->
    <div class="table-container">
        <h5>Sale Items List</h5>
        <table id="saleItemsTable" class="table table-hover">
            <thead>
            <tr>
                <th>ID</th>
                <th>Bidding Price</th>
                <th>Date</th>
                <th>Status</th>
                <th>Item ID</th>
                <th>Sale ID</th>
                <th>User ID</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <!-- Sale items will be loaded dynamically here -->
            </tbody>
        </table>
    </div>
</div>

<script>
    $.ajax({
        url: "http://localhost:8080/sale-items/save", // Your backend API
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({
            id: $("#id").val(),
            biddingPrice: $("#biddingPrice").val(),
            time: $("#time").val(),
            itemId: $("#item_id").val(),
            saleId: $("#sale_id").val(),
            userId: $("#user_id").val(),
            saleStatus: $("input[name='saleStatus']:checked").val()
        }),
        success: function(response) {
            alert("Sale item saved successfully!");
        },
        error: function(xhr, status, error) {
            console.error("Error:", xhr.responseText);
        }
    });


    // Load Sale Items
    function loadSaleItems() {
        $.ajax({
            url: "http://localhost:8082/sale-items/getAll",
            type: "GET",
            success: function (response) {
                if (response.code === 200) {
                    displaySaleItems(response.data);
                } else {
                    console.error("Failed to fetch sale items");
                }
            },
            error: function (error) {
                console.error("Error fetching sale items:", error);
            }
        });
    }

    // Display Sale Items in Table
    function displaySaleItems(saleItems) {
        let tableBody = $("#saleItemsTable tbody");
        tableBody.empty();

        saleItems.forEach(item => {
            let row = `<tr>
                <td>${item.id}</td>
                <td>$${item.biddingPrice.toFixed(2)}</td>
                <td>${item.time}</td>
                <td><span class="badge ${item.saleStatus === 'sold' ? 'bg-success' : 'bg-warning text-dark'}">${item.saleStatus}</span></td>
                <td>${item.item_id}</td>
                <td>${item.sale_id}</td>
                <td>${item.user_id}</td>
                <td>
                    <button class="btn btn-sm btn-primary" onclick="editSaleItem(${item.id})">Edit</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteSaleItem(${item.id})">Delete</button>
                </td>
            </tr>`;
            tableBody.append(row);
        });
    }

    // Edit Sale Item
    function editSaleItem(id) {
        $.ajax({
            url: `http://localhost:8082/sale-items/${id}`,
            type: "GET",
            success: function (item) {
                $("#id").val(item.id);
                $("#biddingPrice").val(item.biddingPrice);
                $("#time").val(item.time);
                $("#item_id").val(item.item_id);
                $("#sale_id").val(item.sale_id);
                $("#user_id").val(item.user_id);
                $("#saleStatus").val(item.saleStatus);
            },
            error: function (error) {
                console.error("Error fetching sale item:", error);
            }
        });
    }

    // Delete Sale Item
    function deleteSaleItem(id) {
        if (confirm("Are you sure you want to delete this sale item?")) {
            $.ajax({
                url: `http://localhost:8082/sale-items/${id}`,
                type: "DELETE",
                success: function () {
                    alert("Sale item deleted successfully!");
                    loadSaleItems();
                },
                error: function (error) {
                    console.error("Error deleting sale item:", error);
                }
            });
        }
    }
</script>

</body>
</html>
